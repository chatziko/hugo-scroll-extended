{{/* Includes are loaded conditionally in custom_body.html */}}

{{- $id := print (.Get "id" | default "gallery") "-container" -}}
{{- $images := resources.Match (.Get "assets") -}}
{{- if .Get "shuffle" -}}
  {{- $images = shuffle $images -}}
{{- end -}}

<div id="{{ $id }}" class="image-gallery fj-gallery">
  {{ range $images }}
    {{- $image := . -}}
    {{- $webp := $image.Resize (printf "%dx%d q90 webp" $image.Width $image.Height) -}}
    {{- $thumb := $image.Fit "380x380 q90 webp" -}}
    <a href="{{ $webp.RelPermalink }}"
      class="fj-gallery-item"
      data-lg-size="{{ $image.Width }}-{{ $image.Height }}"
      data-download-url="{{ $image.RelPermalink }}">
      <img src="{{ $thumb.RelPermalink }}" width="{{ $thumb.Width }}" height="{{ $thumb.Height }}" loading="lazy" />
    </a>
  {{ end }}
</div>
<br>

<script type="text/javascript">
galleryInit(() => {
  fjGallery(document.querySelectorAll('#{{ $id }}'), {
    itemSelector: '.fj-gallery-item',
    rowHeight: 150,
    gutter: 1,
    // transitionDuration: "4s",
    rowHeightTolerance: 0.3,
    onInit: () => {
      lightGallery(document.getElementById('{{ $id }}'), {
        selector: 'a',
        plugins: [lgZoom, /* lgThumbnail, */ lgShare],
        speed: 500,
      })
    },
  })
})
</script>
